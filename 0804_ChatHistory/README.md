# 🌙 古月今语 - AI历史人物对话系统

> **今人不见古时月，今月曾经照古人**

一个基于阿里云百炼平台的沉浸式历史人物AI对话系统，让您与古代智者跨越时空对话。

## ✨ 项目特色

- 🎭 **角色扮演**：与孔子、李白、诸葛亮、武则天、王阳明等历史名人对话
- 🛡️ **安全防护**：内置提示词注入防御机制，确保对话质量
- 🎨 **古风界面**：简洁优雅的古风设计，营造沉浸式体验
- 🖼️ **图像生成**：支持生成历史人物形象
- 💾 **对话记忆**：保存完整对话历史，支持多轮连续对话
- ⚡ **API集成**：完整集成阿里云百炼文本和图像生成API

## 🚀 快速开始

### 环境要求

- Python 3.11+
- 阿里云百炼 API Key

### 安装步骤

1. **克隆项目**
   ```bash
   cd 0804_TraversingHistory
   ```

2. **安装依赖**
   ```bash
   pip install -r requirements.txt
   ```

3. **配置环境**（可选）
   ```bash
   cp .env.example .env
   # 编辑 .env 文件，填入您的API Key
   ```

4. **启动应用**
   ```bash
   python3 run.py
   ```

5. **访问应用**
   
   打开浏览器访问：http://localhost:5000

## 📖 使用指南

### 第一次使用

1. **配置API Key**
   - 点击左侧面板的"API配置"按钮
   - 输入您的阿里云百炼API Key
   - 选择合适的模型（推荐默认设置）
   - 点击"测试连接"验证配置

2. **选择历史人物**
   - 在左侧角色列表中选择您想对话的历史人物
   - 系统支持的角色：
     - 🎓 **孔子**：儒家学派创始人，教育家
     - 🍃 **李白**：唐代诗仙，浪漫主义诗人
     - ⚔️ **诸葛亮**：三国军师，智慧化身
     - 👑 **武则天**：中国唯一女皇帝
     - 📚 **王阳明**：明代哲学家，心学集大成者

3. **开始对话**
   - 在底部输入框输入您的问题
   - 系统会以所选角色的风格回复
   - 支持连续多轮对话

### 高级功能

- **生成角色形象**：点击"生成形象"按钮，描述您想要的角色图片
- **清空对话**：随时点击"清空对话"开始新的话题
- **对话记忆**：系统自动保存对话历史，刷新页面不会丢失

## 🛡️ 安全特性

系统内置多重安全防护机制：

- **提示词注入检测**：自动识别和拒绝尝试修改角色设定的输入
- **内容安全过滤**：过滤敏感和不当内容
- **角色边界保护**：确保AI严格按照历史人物设定回复
- **API Key安全**：本地加密存储，支持部分掩码显示

## 🔧 技术架构

- **后端框架**：Flask + SQLite
- **前端技术**：HTML5 + Tailwind CSS + JavaScript
- **AI服务**：阿里云百炼（通义千问 + 通义万象）
- **数据存储**：SQLite（对话历史、用户配置、角色信息）

## 📝 API配置说明

### 阿里云百炼API

本系统使用阿里云百炼平台的API服务：

- **文本模型**：
  - `qwen-plus`（推荐）：平衡性能和成本
  - `qwen-max`：最高质量，适合重要对话
  - `qwen-turbo`：快速响应，适合简单对话

- **图像模型**：
  - `wan2.2-t2i-flash`（推荐）：快速生成
  - `wan2.2-t2i`：高质量生成

### 获取API Key

1. 访问 [阿里云百炼控制台](https://dashscope.console.aliyun.com/)
2. 开通相关服务并获取API Key
3. 在应用中配置API Key即可使用

## 🎨 界面设计

采用古风设计理念：

- **色彩主题**：温润的古典色调，柔和护眼
- **字体选择**：Noto Serif SC，兼顾古风与可读性
- **交互体验**：流畅的动画效果，营造沉浸感
- **响应式设计**：适配各种屏幕尺寸

## 🔄 项目结构

```
0804_TraversingHistory/
├── app.py              # Flask主应用
├── models.py           # 数据库模型
├── api_service.py      # 阿里云API服务
├── config.py           # 配置管理
├── run.py              # 启动脚本
├── requirements.txt    # 依赖包
├── .env.example        # 环境配置示例
├── templates/
│   └── index.html      # 主页面模板
├── static/
│   └── js/
│       └── app.js      # 前端脚本
├── chat.md             # 项目文档
└── README.md           # 使用指南
```

---

**古月今语，让历史智慧照亮现代人心** 🌙✨

**📧 联系方式**: 如有问题请WOA联系 韩希钰 / hanxiyu@wps.cn