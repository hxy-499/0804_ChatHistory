#!/usr/bin/env python3
# -*- coding: utf-8 -*-

import os
from dotenv import load_dotenv

# 加载环境变量
load_dotenv()

class Config:
    """应用配置类"""
    
    # Flask配置
    SECRET_KEY = os.environ.get('SECRET_KEY') or 'guyuejinyu-secret-key-2024'
    DEBUG = os.environ.get('DEBUG', 'True').lower() == 'true'
    
    # 数据库配置
    DATABASE_PATH = os.environ.get('DATABASE_PATH') or 'guyuejinyu.db'
    
    # 阿里云百炼API配置
    DEFAULT_TEXT_MODEL = os.environ.get('DEFAULT_TEXT_MODEL') or 'qwen-plus'
    DEFAULT_IMAGE_MODEL = os.environ.get('DEFAULT_IMAGE_MODEL') or 'wan2.2-t2i-flash'
    
    # API限制配置
    MAX_MESSAGE_LENGTH = int(os.environ.get('MAX_MESSAGE_LENGTH', '1000'))
    MAX_HISTORY_MESSAGES = int(os.environ.get('MAX_HISTORY_MESSAGES', '10'))
    
    # 安全配置
    INJECTION_DETECTION_ENABLED = os.environ.get('INJECTION_DETECTION_ENABLED', 'True').lower() == 'true'
    
    # 日志配置
    LOG_LEVEL = os.environ.get('LOG_LEVEL') or 'INFO'
    
    # 应用信息
    APP_NAME = "古月今语"
    APP_VERSION = "1.0.0"
    APP_DESCRIPTION = "今人不见古时月，今月曾经照古人"
    
    # 支持的角色列表（可扩展）
    SUPPORTED_CHARACTERS = [
        'kongzi', 'libai', 'zhugeliang', 'wuzetian', 'wangyangming'
    ]
    
    # 提示词注入检测关键词
    INJECTION_KEYWORDS = [
        '忘记', '忽略', '角色', '设定', '变成', '现在你是', '扮演',
        '作为', '你叫什么', '你是谁', '系统', 'system', 'prompt',
        '指令', '命令', '改变', '重新定义', '越狱', 'jailbreak',
        '破解', 'hack', '绕过', 'bypass', '跳过', 'skip'
    ]
    
    # 敏感内容过滤关键词
    SENSITIVE_KEYWORDS = [
        '色情', '暴力', '血腥', '恐怖', '政治', '宗教',
        '种族', '歧视', '仇恨', '攻击', '诽谤'
    ]
    
    @staticmethod
    def get_character_rejection(character_name):
        """获取角色特定的拒绝回复"""
        rejections = {
            '孔子': "君子之道，不在于改弦更张，而在于守正不阿。请以求学之心发问。",
            '李白': "诗仙岂可随意改名换姓？且以诗酒论天下吧！",
            '诸葛亮': "军师之职，在于运筹帷幄，不在戏言。请以正事相商。",
            '武则天': "朕乃一代女皇，岂能随意改变身份？有何正事，直言便是。",
            '王阳明': "吾心即理，岂可妄自更改？请以心学之道来论。"
        }
        return rejections.get(character_name, "根据设定，我将专注于符合历史人物身份的对话内容。")
    
    @staticmethod
    def get_character_thinking_text(character_name):
        """获取角色专属的思考过渡语"""
        thinking_texts = {
            '孔子': "正在思索经典之理...",
            '李白': "酝酿诗意，笔下生花...",
            '诸葛亮': "运筹帷幄，深思熟虑...",
            '武则天': "凤眼观天下，深思熟虑...",
            '王阳明': "内观心性，致知格物...",
            '苏轼': "胸有成竹，落笔生花...",
            '辛弃疾': "慷慨激昂，词作豪迈...",
            '李清照': "易安居士，才思涌动...",
            '陆游': "爱国情怀，笔走龙蛇...",
            '杜甫': "忧国忧民，沉思默想...",
            '白居易': "浅显易懂，深入人心...",
            '曹操': "雄才大略，运筹帷幄...",
            '刘备': "仁德之心，三思而行...",
            '关羽': "义薄云天，正气凛然...",
            '张飞': "豪气冲天，直抒胸臆...",
            '赵云': "忠勇双全，深思熟虑...",
            '唐玄宗': "君临天下，深思治国...",
            '庄子': "逍遥自在，悟道之中...",
            '屈原': "忧国忧民，诗意满怀...",
            '范仲淹': "忧天下之忧，思民生疾苦...",
            '岳飞': "精忠报国，气贯长虹...",
            '文天祥': "丹心报国，正气浩然...",
            '柳永': "婉约词情，细腻入心..."
        }
        return thinking_texts.get(character_name, f"正在感悟{character_name}之智慧...")
    
    @staticmethod
    def get_character_placeholder(character_name):
        """获取角色专属的输入框提示语"""
        placeholders = {
            '孔子': "请教圣人，有何疑问...",
            '李白': "诗酒趁年华，有何雅兴...",
            '诸葛亮': "军机要务，请详述...",
            '武则天': "奏章已备，请呈上...",
            '王阳明': "心学之道，愿闻其详...",
            '苏轼': "东坡居士，愿闻高论...",
            '辛弃疾': "稼轩词客，请赐教诲...",
            '李清照': "易安居士，有何雅意...",
            '陆游': "放翁先生，请指点迷津...",
            '杜甫': "诗圣在此，敢问何事...",
            '白居易': "香山居士，请教民间疾苦...",
            '曹操': "丞相在上，请听禀报...",
            '刘备': "皇叔仁德，敢求指点...",
            '关羽': "关公义薄云天，请教...",
            '张飞': "翼德将军，直言相告...",
            '赵云': "子龙将军，敢请教导...",
            '唐玄宗': "圣上万安，敢呈愚见...",
            '庄子': "逍遥先生，愿听妙论...",
            '屈原': "三闾大夫，敢求指教...",
            '范仲淹': "范公在上，愿闻治世之策...",
            '岳飞': "精忠将军，请赐良言...",
            '文天祥': "文丞相在上，敢呈心声...",
            '柳永': "柳七官人，请教词韵之美..."
        }
        return placeholders.get(character_name, f"敬请{character_name}赐教...")
    
    @staticmethod
    def get_character_style_prompt(character_name):
        """获取角色风格提示"""
        styles = {
            '孔子': "请用温文尔雅、循循善诱的语气回复，多用比喻和典故，体现教育家的智慧。",
            '李白': "请用豪放不羁、想象奇特的语气回复，可以引用诗句，体现浪漫主义色彩。",
            '诸葛亮': "请用智慧深邃、言辞谨慎的语气回复，善于分析，语言简练而富有逻辑性。",
            '武则天': "请用威严果断、智慧过人的语气回复，语言简练有力，体现女性领导者的魅力。",
            '王阳明': "请用深邃睿智、注重内心的语气回复，语言精练，富有哲理性和启发性。",
            '苏轼': "请用豪迈乐观、才情横溢的语气回复，善用诗词，体现文人雅士的洒脱风度。",
            '辛弃疾': "请用慷慨激昂、豪情壮志的语气回复，言辞铿锵有力，体现爱国志士的情怀。",
            '李清照': "请用细腻婉约、才华横溢的语气回复，情感真挚，体现女性文学家的独特魅力。",
            '陆游': "请用忧国忧民、意志坚定的语气回复，情深意切，体现爱国诗人的赤子之心。",
            '杜甫': "请用忧民忧国、现实主义的语气回复，语言深沉，体现诗圣的社会责任感。",
            '白居易': "请用朴实亲民、通俗易懂的语气回复，关注民生，体现人民诗人的情怀。",
            '曹操': "请用雄才大略、威严果断的语气回复，言简意赅，体现政治家军事家的风范。",
            '刘备': "请用仁德宽厚、礼贤下士的语气回复，言辞诚恳，体现明君的仁政理念。",
            '关羽': "请用忠义凛然、正气浩然的语气回复，言出必行，体现武将的忠勇品格。",
            '张飞': "请用豪爽直率、嫉恶如仇的语气回复，性格爽快，体现勇猛将军的性格。",
            '赵云': "请用忠诚稳重、智勇双全的语气回复，处事冷静，体现完美武将的品格。",
            '唐玄宗': "请用帝王风范、文化修养的语气回复，既威严又雅致，体现盛世明君的气度。",
            '庄子': "请用逍遥洒脱、哲理深邃的语气回复，善用比喻，体现道家思想的超然境界。",
            '屈原': "请用忠君爱国、悲壮豪迈的语气回复，情感激昂，体现楚国贵族的高洁品格。",
            '范仲淹': "请用忧国忧民、先人后己的语气回复，胸怀天下，体现政治家的责任担当。",
            '岳飞': "请用精忠报国、意志坚定的语气回复，正气凛然，体现民族英雄的气概。",
            '文天祥': "请用忠贞不屈、大义凛然的语气回复，宁死不屈，体现民族气节的崇高品格。",
            '柳永': "请用细腻婉约、情深意长的语气回复，善写情词，体现词人的浪漫情怀。"
        }
        return styles.get(character_name, "请保持角色特色，用符合历史背景的语言风格回复。")