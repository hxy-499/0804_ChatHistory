# 🌙 古月今语 - AI历史人物对话

> **今人不见古时月，今月曾经照古人**

一个基于阿里云百炼平台的沉浸式历史人物AI对话系统，集成了强大的管理员后台，让您与古代智者跨越时空对话，同时提供全面的数据监控和管理功能。

## 🔄 项目结构

```
0804_ChatHistory_web/
├── app.py                    # Flask主应用（含管理员路由）
├── models.py                 # 数据库模型（含管理员数据查询）
├── api_service.py            # 阿里云API服务
├── config.py                 # 配置管理
├── start.py                  # 启动脚本
├── wsgi.py                   # WSGI入口文件（生产部署）
├── requirements.txt          # 依赖包
├── .env.example              # 环境配置示例
├── templates/
│   ├── index.html            # 用户主页面模板
│   ├── admin_login.html      # 管理员登录页面
│   └── admin_dashboard.html  # 管理员仪表板
├── static/
│   ├── js/
│   │   └── app.js            # 前端脚本
│   └── images/               # 图片资源
├── guyuejinyu.db            # SQLite数据库文件
├── admin.txt                # 管理员功能需求文档
├── admin_guide.md           # 管理员系统使用指南
├── prompt_security.md      # 安全防护说明
├── chat.md                  # 对话规范示例文档
├── deploy_guide.md          # 部署指南
├── gunicorn.conf.py         # Gunicorn配置文件
├── supervisor.conf          # Supervisor配置文件
├── nginx.conf               # Nginx配置文件
└── README.md                # 项目使用指南
```

## 🚀 快速开始

### 环境要求

- Python 3.11+
- 阿里云百炼 API Key

### 本地开发
```bash
# 安装依赖
pip install -r requirements.txt

# 启动开发服务器
python3 start.py
```
### 访问应用

#### 本地开发环境
- **用户端**：http://localhost:6888
- **管理员后台**：http://localhost:6888/admin
- **管理员默认账号**：admin / admin123 

#### 线上演示环境
- **🌐 用户端**：https://my.chathistory.site
- **👑 管理员后台**：https://my.chathistory.site/admin
- **管理员账号**：admin / admin123

## ✨ 项目特色

### 🎭 用户体验
- **角色扮演**：与孔子、李白、诸葛亮、武则天、王阳明等历史名人对话
- **古风界面**：简洁优雅的古风设计，营造沉浸式体验
- **图像生成**：支持生成历史人物形象
- **对话记忆**：保存完整对话历史，支持多轮连续对话

### 🛡️ 安全防护
- **提示词注入防御**：内置多重安全防护机制
- **内容安全过滤**：智能识别和过滤不当内容
- **角色边界保护**：确保AI严格按照历史人物设定回复

### 👑 管理员系统
- **数据可视化仪表板**：系统统计、用户行为分析、性能监控
- **AI配置管理**：模型选择、响应阈值、安全等级设定
- **用户行为洞察**：活跃用户分析、角色偏好统计
- **对话记录管理**：历史对话查看、搜索、分类管理
- **性能监控**：AI响应成功率、24小时消息分布统计
- **内容安全管理**：敏感内容拦截统计、过滤规则配置

### ⚡ 技术特性
- **API集成**：完整集成阿里云百炼文本和图像生成API
- **响应式设计**：适配各种屏幕尺寸
- **实时数据**：AJAX异步加载，流畅用户体验



## 🌟 功能亮点

### 🎯 双端体验
- **用户端**：沉浸式古风对话界面，与历史名人畅聊
- **管理端**：现代化数据仪表板，全面监控系统运行

### 📊 实时数据监控
- **智能图表**：Chart.js驱动的实时数据可视化
- **用户洞察**：深度分析用户行为和偏好
- **性能追踪**：24/7监控AI响应性能

### 🔐 企业级安全
- **多重防护**：提示词注入防御 + 内容安全过滤
- **访问控制**：严格的管理员权限验证
- **数据安全**：加密存储 + 审计日志

### 🚀 技术优势
- **零依赖部署**：SQLite + Flask，开箱即用
- **响应式设计**：完美适配各种设备
- **模块化架构**：易于扩展和维护

## 📖 使用指南

### 👤 用户端使用

#### 第一次使用

1. **配置API Key**
   - 点击左侧面板的"API配置"按钮
   - 输入您的阿里云百炼API Key [阿里云百炼控制台](https://dashscope.console.aliyun.com/)
   - 选择合适的模型（推荐默认设置）
   - 点击"测试连接"验证配置

2. **选择历史人物**
   - 在左侧角色列表中选择您想对话的历史人物
   - 系统支持的角色：
     - 🎓 **孔子**：儒家学派创始人，教育家
     - 🍃 **李白**：唐代诗仙，浪漫主义诗人
     - ⚔️ **诸葛亮**：三国军师，智慧化身
     - 👑 **武则天**：中国唯一女皇帝
     - 📚 **王阳明**：明代哲学家，心学集大成者
     - **任何历史上真实存在的人物**

3. **开始对话**
   - 在底部输入框输入您的问题
   - 系统会以所选角色的风格回复
   - 支持连续多轮对话

#### 高级功能

- **生成角色形象**：点击"生成形象"按钮，描述您想要的角色图片
- **清空对话**：随时点击"清空对话"开始新的话题
- **对话记忆**：系统自动保存对话历史，刷新页面不会丢失

### 👑 管理员后台使用

#### 登录方式

1. **访问管理后台**：
   - 本地环境：http://localhost:6888/admin
   - 线上环境：https://my.chathistory.site/admin
2. **默认账号**：admin / admin123
3. **登录后进入管理仪表板**

#### 功能模块

1. **📊 系统统计与报告**
   - 查看总用户数、对话数、消息数
   - 用户活跃度趋势图
   - 最受欢迎角色排行

2. **⚙️ AI配置面板**
   - 模型选择和参数配置
   - 响应阈值设定
   - 内容安全等级调整

3. **👥 用户行为洞察**
   - 活跃用户排行分析
   - 角色偏好统计
   - 用户画像数据

4. **💬 问题库与知识管理**
   - 历史对话记录查看
   - 对话内容搜索
   - 分页浏览和管理

5. **📈 AI性能监控**
   - AI响应成功率统计
   - 24小时消息量分布
   - 图片生成性能监控

6. **🛡️ 内容安全与过滤**
   - 敏感内容拦截统计
   - 过滤规则开关管理
   - 安全策略配置

## 🛡️ 安全特性

系统内置多重安全防护机制：

### 🔒 对话安全
- **提示词注入检测**：自动识别和拒绝尝试修改角色设定的输入
- **内容安全过滤**：过滤敏感和不当内容
- **角色边界保护**：确保AI严格按照历史人物设定回复
- **API Key安全**：本地加密存储，支持部分掩码显示

### 🛡️ 管理员安全
- **身份验证**：Session验证机制，防止未授权访问
- **权限控制**：严格的管理员权限验证
- **数据保护**：敏感数据加密存储
- **审计日志**：完整的操作记录追踪

## 🔧 技术架构

### 🏗️ 后端架构
- **Web框架**：Flask + SQLite
- **数据库**：SQLite（对话历史、用户配置、角色信息、管理数据）
- **AI服务**：阿里云百炼（通义千问 + 通义万象）
- **缓存机制**：内存缓存优化性能

### 🎨 前端架构
- **基础技术**：HTML5 + CSS3 + JavaScript ES6+
- **样式框架**：Tailwind CSS
- **图表库**：Chart.js（管理员仪表板）
- **图标库**：FontAwesome
- **响应式设计**：适配移动端和桌面端

### 📊 数据分析
- **实时统计**：用户活跃度、对话统计、性能监控
- **数据可视化**：趋势图表、分布统计、排行榜
- **性能监控**：响应时间、成功率、错误率追踪

## 📝 API配置说明

### 阿里云百炼API

本系统使用阿里云百炼平台的API服务：

- **文本模型**：
  - `qwen-plus`（推荐）：平衡性能和成本
  - `qwen-max`：最高质量，适合重要对话
  - `qwen-turbo`：快速响应，适合简单对话

- **图像模型**：
  - `wan2.2-t2i-flash`（推荐）：快速生成
  - `wan2.2-t2i`：高质量生成


### 生产环境建议
- 使用 **Gunicorn** 或 **uWSGI** 作为 WSGI 服务器
- 配置 **Nginx** 反向代理
- 设置 **HTTPS** 证书
- 修改默认管理员密码
- 配置日志轮转和监控

## 🎯 未来规划

- [ ] 多语言支持（英文、日文等）
- [ ] 更多历史人物角色
- [ ] 语音对话功能
- [ ] 移动端App
- [ ] AI训练数据优化
- [ ] 集群部署支持

---

**古月今语，让历史智慧照亮现代人心** 🌙✨

**📧 联系方式**: 如有问题请WOA联系 韩希钰 / hanxiyu@wps.cn